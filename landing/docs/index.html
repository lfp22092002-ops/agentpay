<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgentPay ‚Äî Developer Documentation</title>
  <meta name="description" content="AgentPay API documentation. Learn how to integrate payments into your AI agents.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <style>
    /* ============================================
       AgentPay Docs Styles
       ============================================ */
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0a0a0a;
      --bg-elevated: #111111;
      --bg-card: #141414;
      --border: #1e1e1e;
      --border-hover: #2a2a2a;
      --text: #ffffff;
      --text-secondary: #a0a0a0;
      --text-dim: #666666;
      --accent: #6366f1;
      --accent-light: #818cf8;
      --accent-purple: #8b5cf6;
      --gradient: linear-gradient(135deg, #6366f1, #8b5cf6);
      --font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --mono: 'JetBrains Mono', 'Fira Code', monospace;
      --sidebar-w: 280px;
    }

    html { scroll-behavior: smooth; -webkit-font-smoothing: antialiased; }
    body { font-family: var(--font); background: var(--bg); color: var(--text); line-height: 1.7; }
    a { color: var(--accent-light); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* --- Top Nav --- */
    .docs-nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      height: 56px;
      background: rgba(10,10,10,0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; padding: 0 24px;
    }
    .docs-nav-logo {
      display: flex; align-items: center; gap: 10px;
      font-weight: 700; font-size: 16px; color: var(--text); text-decoration: none;
    }
    .docs-nav-logo:hover { text-decoration: none; }
    .docs-nav-links {
      margin-left: auto; display: flex; gap: 20px; align-items: center;
    }
    .docs-nav-links a {
      color: var(--text-secondary); font-size: 13px; font-weight: 500; text-decoration: none;
    }
    .docs-nav-links a:hover { color: var(--text); text-decoration: none; }

    .sidebar-toggle {
      display: none; background: none; border: none; color: var(--text);
      cursor: pointer; padding: 4px; margin-right: 12px;
    }

    /* --- Layout --- */
    .docs-layout {
      display: flex; min-height: 100vh; padding-top: 56px;
    }

    /* --- Sidebar --- */
    .sidebar {
      position: fixed; top: 56px; left: 0; bottom: 0;
      width: var(--sidebar-w);
      background: var(--bg-elevated);
      border-right: 1px solid var(--border);
      overflow-y: auto; padding: 24px 0;
      scrollbar-width: thin;
      scrollbar-color: #333 transparent;
    }
    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

    .sidebar-section { margin-bottom: 24px; }
    .sidebar-heading {
      font-size: 11px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.08em; color: var(--text-dim); padding: 0 24px; margin-bottom: 8px;
    }
    .sidebar a {
      display: block; padding: 6px 24px; font-size: 13px; font-weight: 400;
      color: var(--text-secondary); text-decoration: none; transition: all 0.15s;
      border-left: 2px solid transparent;
    }
    .sidebar a:hover { color: var(--text); background: rgba(255,255,255,0.03); text-decoration: none; }
    .sidebar a.active {
      color: var(--accent-light); border-left-color: var(--accent);
      background: rgba(99,102,241,0.05);
    }
    .sidebar a.sub { padding-left: 40px; font-size: 12px; }

    /* --- Main Content --- */
    .docs-content {
      margin-left: var(--sidebar-w);
      flex: 1;
      max-width: 820px;
      padding: 48px 48px 120px;
    }

    /* --- Typography --- */
    .docs-content h1 {
      font-size: 32px; font-weight: 800; letter-spacing: -0.02em;
      margin-bottom: 12px; line-height: 1.2;
    }
    .docs-content h2 {
      font-size: 24px; font-weight: 700; margin-top: 64px; margin-bottom: 16px;
      padding-top: 24px; border-top: 1px solid var(--border);
      letter-spacing: -0.01em;
    }
    .docs-content h2:first-of-type { margin-top: 40px; border-top: none; padding-top: 0; }
    .docs-content h3 {
      font-size: 18px; font-weight: 600; margin-top: 32px; margin-bottom: 12px;
    }
    .docs-content h4 {
      font-size: 15px; font-weight: 600; margin-top: 24px; margin-bottom: 8px;
      color: var(--text-secondary);
    }
    .docs-content p {
      margin-bottom: 16px; color: var(--text-secondary); font-size: 15px;
    }
    .docs-content strong { color: var(--text); }
    .docs-content ul, .docs-content ol {
      margin-bottom: 16px; padding-left: 20px;
    }
    .docs-content li {
      margin-bottom: 6px; font-size: 15px; color: var(--text-secondary);
    }
    .docs-content > .lead {
      font-size: 17px; color: var(--text-secondary); margin-bottom: 32px;
    }

    /* --- Inline Code --- */
    .docs-content code:not(pre code) {
      font-family: var(--mono); font-size: 13px;
      background: rgba(99,102,241,0.1);
      color: var(--accent-light);
      padding: 2px 6px; border-radius: 4px;
    }

    /* --- Code Blocks --- */
    .code-wrapper {
      position: relative; margin-bottom: 20px;
      border: 1px solid var(--border); border-radius: 8px; overflow: hidden;
    }
    .code-label {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 16px;
      background: #161616; border-bottom: 1px solid var(--border);
      font-size: 12px; color: var(--text-dim);
    }
    .copy-btn {
      display: inline-flex; align-items: center; gap: 4px;
      background: transparent; border: 1px solid var(--border);
      color: var(--text-secondary); font-family: var(--font);
      font-size: 11px; padding: 3px 8px; border-radius: 4px;
      cursor: pointer; transition: all 0.15s;
    }
    .copy-btn:hover { border-color: var(--border-hover); color: var(--text); }
    .copy-btn.copied { color: #22c55e; border-color: #22c55e; }

    .code-wrapper pre {
      margin: 0; padding: 16px; overflow-x: auto;
      background: #0d0d0d !important;
    }
    .code-wrapper pre code {
      font-family: var(--mono); font-size: 13px; line-height: 1.7;
      background: none !important; padding: 0 !important;
    }

    /* --- Method Badges --- */
    .method {
      display: inline-block; padding: 2px 8px; border-radius: 4px;
      font-family: var(--mono); font-size: 12px; font-weight: 600;
      margin-right: 8px; vertical-align: middle;
    }
    .method-get { background: rgba(34,197,94,0.15); color: #22c55e; }
    .method-post { background: rgba(59,130,246,0.15); color: #60a5fa; }

    .endpoint-path {
      font-family: var(--mono); font-size: 14px; font-weight: 500;
    }

    /* --- Tables --- */
    .docs-table {
      width: 100%; border-collapse: collapse; margin-bottom: 20px;
      font-size: 14px;
    }
    .docs-table th {
      text-align: left; padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      font-size: 12px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.05em; color: var(--text-dim);
    }
    .docs-table td {
      padding: 10px 12px; border-bottom: 1px solid var(--border);
      color: var(--text-secondary); vertical-align: top;
    }
    .docs-table td:first-child { color: var(--text); font-family: var(--mono); font-size: 13px; }
    .docs-table td code { font-size: 12px; }

    /* --- Callout --- */
    .callout {
      padding: 16px 20px; border-radius: 8px; margin-bottom: 20px;
      font-size: 14px; display: flex; gap: 12px;
    }
    .callout-info {
      background: rgba(99,102,241,0.08); border: 1px solid rgba(99,102,241,0.2);
      color: var(--text-secondary);
    }
    .callout-warn {
      background: rgba(234,179,8,0.08); border: 1px solid rgba(234,179,8,0.2);
      color: var(--text-secondary);
    }
    .callout-icon { font-size: 18px; flex-shrink: 0; }

    /* --- Responsive --- */
    @media (max-width: 900px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.25s ease;
        z-index: 50;
      }
      .sidebar.open { transform: translateX(0); }
      .sidebar-toggle { display: block; }
      .docs-content { margin-left: 0; padding: 32px 20px 80px; }
    }
  </style>
</head>
<body>
  <!-- Top Nav -->
  <nav class="docs-nav">
    <button class="sidebar-toggle" aria-label="Toggle sidebar" onclick="document.querySelector('.sidebar').classList.toggle('open')">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M3 5h14M3 10h14M3 15h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
    </button>
    <a href="/" class="docs-nav-logo">
      <svg width="22" height="22" viewBox="0 0 28 28" fill="none"><rect width="28" height="28" rx="6" fill="url(#dlg)"/><path d="M8 19V9l6 10V9" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 9h3a2 2 0 010 4h-3m0-4v10m0-6h2.5" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><defs><linearGradient id="dlg" x1="0" y1="0" x2="28" y2="28"><stop stop-color="#6366f1"/><stop offset="1" stop-color="#8b5cf6"/></linearGradient></defs></svg>
      AgentPay <span style="color:#666;font-weight:400;margin-left:4px">Docs</span>
    </a>
    <div class="docs-nav-links">
      <a href="/">Home</a>
      <a href="https://t.me/FundmyAIbot" target="_blank" rel="noopener">Telegram Bot</a>
      <a href="https://github.com/agentpay" target="_blank" rel="noopener">GitHub</a>
    </div>
  </nav>

  <div class="docs-layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-heading">Getting Started</div>
        <a href="#getting-started">Quick Start</a>
        <a href="#authentication">Authentication</a>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-heading">API Reference</div>
        <a href="#endpoints">Endpoints Overview</a>
        <a href="#spend" class="sub">POST /v1/spend</a>
        <a href="#balance" class="sub">GET /v1/balance</a>
        <a href="#transactions" class="sub">GET /v1/transactions</a>
        <a href="#wallet" class="sub">GET /v1/wallet</a>
        <a href="#send-usdc" class="sub">POST /v1/wallet/send-usdc</a>
        <a href="#card" class="sub">GET /v1/card</a>
        <a href="#webhook-endpoint" class="sub">POST /v1/webhook</a>
        <a href="#approvals" class="sub">GET /v1/approvals/{id}</a>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-heading">Guides</div>
        <a href="#webhooks">Webhooks</a>
        <a href="#approval-workflow">Approval Workflow</a>
        <a href="#error-codes">Error Codes</a>
        <a href="#python-sdk">Python SDK</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="docs-content">
      <h1>AgentPay Documentation</h1>
      <p class="lead">Everything you need to give your AI agent a wallet. Fund via Telegram Stars, spend via API.</p>

      <!-- Getting Started -->
      <h2 id="getting-started">Getting Started</h2>
      <p>Get your agent making payments in under 5 minutes.</p>

      <h3>1. Create your agent via Telegram</h3>
      <p>Open <a href="https://t.me/FundmyAIbot" target="_blank" rel="noopener">@FundmyAIbot</a> on Telegram and send <code>/start</code>. Follow the prompts to create a new agent.</p>

      <h3>2. Get your API key</h3>
      <p>After creating an agent, the bot will generate an API key starting with <code>ak_live_</code>. Store this securely ‚Äî it&rsquo;s shown only once.</p>

      <h3>3. Fund your agent</h3>
      <p>Use the Telegram bot to top up your agent&rsquo;s balance with Telegram Stars. The funds are instantly available.</p>

      <h3>4. Make your first API call</h3>
      <div class="code-wrapper">
        <div class="code-label">
          <span>Shell</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-bash">curl -X POST https://api.agentpay.dev/v1/spend \
  -H "Content-Type: application/json" \
  -H "X-API-Key: ak_live_your_api_key" \
  -d '{
    "amount": 1.00,
    "description": "Test payment"
  }'</code></pre>
      </div>
      <p>If successful, you&rsquo;ll get a <code>200</code> response with the transaction details.</p>

      <!-- Authentication -->
      <h2 id="authentication">Authentication</h2>
      <p>All API requests require an API key sent via the <code>X-API-Key</code> header.</p>

      <div class="code-wrapper">
        <div class="code-label">
          <span>HTTP Header</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-http">X-API-Key: ak_live_your_api_key</code></pre>
      </div>

      <div class="callout callout-warn">
        <span class="callout-icon">‚ö†Ô∏è</span>
        <div><strong>Keep your API key secret.</strong> Do not expose it in client-side code, public repos, or logs. If compromised, rotate it immediately via the Telegram bot with <code>/rotate_key</code>.</div>
      </div>

      <h3>Key types</h3>
      <table class="docs-table">
        <thead><tr><th>Prefix</th><th>Environment</th><th>Description</th></tr></thead>
        <tbody>
          <tr><td>ak_live_</td><td>Production</td><td>Real transactions, real money</td></tr>
          <tr><td>ak_test_</td><td>Sandbox</td><td>Test transactions, no real charges</td></tr>
        </tbody>
      </table>

      <!-- Endpoints -->
      <h2 id="endpoints">Endpoints Reference</h2>
      <p>Base URL: <code>https://api.agentpay.dev</code></p>
      <p>All request and response bodies are JSON. All amounts are in USD.</p>

      <!-- POST /v1/spend -->
      <h3 id="spend"><span class="method method-post">POST</span><span class="endpoint-path">/v1/spend</span></h3>
      <p>Create a spend transaction. Deducts from your agent&rsquo;s balance.</p>

      <h4>Request Body</h4>
      <table class="docs-table">
        <thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead>
        <tbody>
          <tr><td>amount</td><td><code>number</code></td><td>Yes</td><td>Amount in USD (min 0.01)</td></tr>
          <tr><td>description</td><td><code>string</code></td><td>Yes</td><td>Human-readable description</td></tr>
          <tr><td>idempotency_key</td><td><code>string</code></td><td>No</td><td>Unique key to prevent duplicate charges</td></tr>
          <tr><td>skip_approval</td><td><code>boolean</code></td><td>No</td><td>Skip manual approval (default: <code>false</code>). Only works if amount is under auto-approve threshold.</td></tr>
        </tbody>
      </table>

      <h4>Example</h4>
      <div class="code-wrapper">
        <div class="code-label">
          <span>Request</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-bash">curl -X POST https://api.agentpay.dev/v1/spend \
  -H "Content-Type: application/json" \
  -H "X-API-Key: ak_live_your_api_key" \
  -d '{
    "amount": 5.00,
    "description": "OpenAI GPT-4 API call",
    "idempotency_key": "req_abc123",
    "skip_approval": false
  }'</code></pre>
      </div>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Response ‚Äî 200 OK</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-json">{
  "id": "txn_8x7k2mNpQ",
  "status": "completed",
  "amount": 5.00,
  "description": "OpenAI GPT-4 API call",
  "idempotency_key": "req_abc123",
  "balance_remaining": 245.00,
  "created_at": "2026-02-23T07:00:00Z"
}</code></pre>
      </div>

      <div class="callout callout-info">
        <span class="callout-icon">üí°</span>
        <div>If the amount exceeds your auto-approve threshold and <code>skip_approval</code> is <code>false</code>, the response will have <code>"status": "pending_approval"</code>. The owner will be notified on Telegram.</div>
      </div>

      <!-- GET /v1/balance -->
      <h3 id="balance"><span class="method method-get">GET</span><span class="endpoint-path">/v1/balance</span></h3>
      <p>Get your agent&rsquo;s current balance.</p>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Response ‚Äî 200 OK</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-json">{
  "available": 245.00,
  "pending": 10.00,
  "currency": "USD"
}</code></pre>
      </div>

      <!-- GET /v1/transactions -->
      <h3 id="transactions"><span class="method method-get">GET</span><span class="endpoint-path">/v1/transactions</span></h3>
      <p>List recent transactions. Supports pagination.</p>

      <h4>Query Parameters</h4>
      <table class="docs-table">
        <thead><tr><th>Param</th><th>Type</th><th>Default</th><th>Description</th></tr></thead>
        <tbody>
          <tr><td>limit</td><td><code>integer</code></td><td>20</td><td>Number of results (max 100)</td></tr>
          <tr><td>offset</td><td><code>integer</code></td><td>0</td><td>Offset for pagination</td></tr>
          <tr><td>status</td><td><code>string</code></td><td>‚Äî</td><td>Filter by status: <code>completed</code>, <code>pending_approval</code>, <code>declined</code></td></tr>
        </tbody>
      </table>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Response ‚Äî 200 OK</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-json">{
  "transactions": [
    {
      "id": "txn_8x7k2mNpQ",
      "amount": 5.00,
      "description": "OpenAI GPT-4 API call",
      "status": "completed",
      "created_at": "2026-02-23T07:00:00Z"
    }
  ],
  "total": 42,
  "limit": 20,
  "offset": 0
}</code></pre>
      </div>

      <!-- GET /v1/wallet -->
      <h3 id="wallet"><span class="method method-get">GET</span><span class="endpoint-path">/v1/wallet</span></h3>
      <p>Get your agent&rsquo;s USDC wallet details.</p>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Response ‚Äî 200 OK</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-json">{
  "address": "0x1234...abcd",
  "chain": "base",
  "balance_usdc": 150.00,
  "created_at": "2026-01-15T12:00:00Z"
}</code></pre>
      </div>

      <!-- POST /v1/wallet/send-usdc -->
      <h3 id="send-usdc"><span class="method method-post">POST</span><span class="endpoint-path">/v1/wallet/send-usdc</span></h3>
      <p>Send USDC from your agent&rsquo;s wallet to an external address.</p>

      <h4>Request Body</h4>
      <table class="docs-table">
        <thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead>
        <tbody>
          <tr><td>to_address</td><td><code>string</code></td><td>Yes</td><td>Recipient wallet address</td></tr>
          <tr><td>amount</td><td><code>number</code></td><td>Yes</td><td>Amount in USDC</td></tr>
          <tr><td>chain</td><td><code>string</code></td><td>No</td><td>Chain to send on (default: <code>base</code>). Options: <code>base</code>, <code>ethereum</code>, <code>polygon</code></td></tr>
        </tbody>
      </table>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Response ‚Äî 200 OK</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-json">{
  "id": "send_xk29m...",
  "status": "pending",
  "tx_hash": "0xabc123...",
  "amount": 50.00,
  "to_address": "0x5678...efgh",
  "chain": "base"
}</code></pre>
      </div>

      <!-- GET /v1/card -->
      <h3 id="card"><span class="method method-get">GET</span><span class="endpoint-path">/v1/card</span></h3>
      <p>Get your agent&rsquo;s virtual Visa card details.</p>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Response ‚Äî 200 OK</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-json">{
  "card_id": "card_m8x2...",
  "last4": "4242",
  "brand": "visa",
  "exp_month": 12,
  "exp_year": 2027,
  "status": "active",
  "spending_limit": 500.00
}</code></pre>
      </div>

      <div class="callout callout-info">
        <span class="callout-icon">üí°</span>
        <div>Full card number, CVC, and billing address are only available in the Telegram bot for security. The API returns masked details.</div>
      </div>

      <!-- POST /v1/webhook -->
      <h3 id="webhook-endpoint"><span class="method method-post">POST</span><span class="endpoint-path">/v1/webhook</span></h3>
      <p>Register or update your webhook endpoint.</p>

      <h4>Request Body</h4>
      <table class="docs-table">
        <thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead>
        <tbody>
          <tr><td>url</td><td><code>string</code></td><td>Yes</td><td>HTTPS URL to receive webhooks</td></tr>
          <tr><td>events</td><td><code>string[]</code></td><td>No</td><td>Event types to subscribe to (default: all). See <a href="#webhooks">Webhooks</a>.</td></tr>
          <tr><td>secret</td><td><code>string</code></td><td>No</td><td>Custom signing secret. Auto-generated if omitted.</td></tr>
        </tbody>
      </table>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Response ‚Äî 200 OK</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-json">{
  "id": "wh_3k9x...",
  "url": "https://your-server.com/webhooks/agentpay",
  "events": ["transaction.completed", "approval.required"],
  "secret": "whsec_...",
  "created_at": "2026-02-23T07:00:00Z"
}</code></pre>
      </div>

      <!-- GET /v1/approvals/{id} -->
      <h3 id="approvals"><span class="method method-get">GET</span><span class="endpoint-path">/v1/approvals/{id}</span></h3>
      <p>Check the status of a pending approval request.</p>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Response ‚Äî 200 OK</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-json">{
  "id": "apr_x8m2...",
  "transaction_id": "txn_8x7k2mNpQ",
  "status": "approved",
  "amount": 50.00,
  "description": "Monthly server bill",
  "approved_by": "owner",
  "approved_at": "2026-02-23T07:05:00Z",
  "created_at": "2026-02-23T07:00:00Z"
}</code></pre>
      </div>

      <!-- Webhooks -->
      <h2 id="webhooks">Webhooks</h2>
      <p>Receive real-time notifications when events happen in your agent&rsquo;s account.</p>

      <h3>Setup</h3>
      <p>Register a webhook endpoint via <a href="#webhook-endpoint">POST /v1/webhook</a> or through the Telegram bot with <code>/webhook</code>.</p>

      <h3>Event Types</h3>
      <table class="docs-table">
        <thead><tr><th>Event</th><th>Description</th></tr></thead>
        <tbody>
          <tr><td>transaction.completed</td><td>A spend transaction was completed successfully</td></tr>
          <tr><td>transaction.declined</td><td>A transaction was declined (insufficient funds, limit exceeded)</td></tr>
          <tr><td>approval.required</td><td>A transaction requires manual approval</td></tr>
          <tr><td>approval.approved</td><td>An approval request was approved</td></tr>
          <tr><td>approval.rejected</td><td>An approval request was rejected</td></tr>
          <tr><td>balance.low</td><td>Agent balance fell below the configured threshold</td></tr>
          <tr><td>balance.funded</td><td>Agent balance was topped up</td></tr>
        </tbody>
      </table>

      <h3>Signature Verification</h3>
      <p>Every webhook request includes an <code>X-AgentPay-Signature</code> header containing an HMAC-SHA256 signature of the request body, signed with your webhook secret.</p>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Python ‚Äî Verify Signature</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-python">import hmac
import hashlib

def verify_webhook(payload: bytes, signature: str, secret: str) -> bool:
    expected = hmac.new(
        secret.encode(),
        payload,
        hashlib.sha256
    ).hexdigest()
    return hmac.compare_digest(f"sha256={expected}", signature)</code></pre>
      </div>

      <h3>Retry Policy</h3>
      <p>If your endpoint returns a non-2xx status code, we retry with exponential backoff:</p>
      <ul>
        <li><strong>Attempt 1:</strong> Immediate</li>
        <li><strong>Attempt 2:</strong> After 1 minute</li>
        <li><strong>Attempt 3:</strong> After 5 minutes</li>
        <li><strong>Attempt 4:</strong> After 30 minutes</li>
        <li><strong>Attempt 5:</strong> After 2 hours (final)</li>
      </ul>
      <p>After 5 failed attempts, the webhook is marked as failed and you&rsquo;ll be notified on Telegram.</p>

      <!-- Approval Workflow -->
      <h2 id="approval-workflow">Approval Workflow</h2>
      <p>Control what your agent can spend autonomously vs. what needs your sign-off.</p>

      <h3>How it works</h3>
      <ol>
        <li>Your agent calls <code>POST /v1/spend</code> with an amount</li>
        <li>If the amount is <strong>below</strong> your auto-approve threshold ‚Üí transaction completes instantly</li>
        <li>If the amount is <strong>above</strong> the threshold ‚Üí status is <code>pending_approval</code></li>
        <li>You receive a Telegram notification with one-tap Approve / Reject buttons</li>
        <li>Your agent can poll <code>GET /v1/approvals/{id}</code> to check the status</li>
      </ol>

      <h3>Auto-approve threshold</h3>
      <p>Set via the Telegram bot with <code>/set_threshold &lt;amount&gt;</code>. Default is <strong>$10.00</strong>.</p>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Python ‚Äî Poll for Approval</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-python">import time
import agentpay

client = agentpay.Client(api_key="ak_live_...")

# Create a spend that may need approval
txn = client.spend(amount=100.00, description="Cloud server monthly")

if txn.status == "pending_approval":
    print(f"Waiting for approval: {txn.id}")
    while True:
        approval = client.get_approval(txn.approval_id)
        if approval.status == "approved":
            print("Approved! Transaction will complete.")
            break
        elif approval.status == "rejected":
            print("Rejected by owner.")
            break
        time.sleep(5)  # Poll every 5 seconds
else:
    print(f"Auto-approved: {txn.id}")</code></pre>
      </div>

      <!-- Error Codes -->
      <h2 id="error-codes">Error Codes</h2>
      <p>All errors return a JSON body with <code>error</code> and <code>message</code> fields.</p>

      <div class="code-wrapper">
        <div class="code-label">
          <span>Error Response Format</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-json">{
  "error": "insufficient_funds",
  "message": "Your agent's balance ($5.00) is less than the requested amount ($10.00)."
}</code></pre>
      </div>

      <table class="docs-table">
        <thead><tr><th>Status</th><th>Error Code</th><th>Description</th></tr></thead>
        <tbody>
          <tr><td>401</td><td><code>unauthorized</code></td><td>Missing or invalid API key</td></tr>
          <tr><td>403</td><td><code>forbidden</code></td><td>API key doesn&rsquo;t have permission for this action</td></tr>
          <tr><td>403</td><td><code>insufficient_funds</code></td><td>Not enough balance to complete the transaction</td></tr>
          <tr><td>403</td><td><code>spending_limit_exceeded</code></td><td>Transaction exceeds spending limit</td></tr>
          <tr><td>404</td><td><code>not_found</code></td><td>Resource not found</td></tr>
          <tr><td>429</td><td><code>rate_limited</code></td><td>Too many requests. Retry after the <code>Retry-After</code> header value.</td></tr>
          <tr><td>500</td><td><code>internal_error</code></td><td>Something went wrong on our end. Try again or contact support.</td></tr>
        </tbody>
      </table>

      <!-- Python SDK -->
      <h2 id="python-sdk">Python SDK</h2>
      <p>A Python SDK for AgentPay is coming soon. Here&rsquo;s what the API will look like:</p>

      <div class="callout callout-info">
        <span class="callout-icon">üì¶</span>
        <div>The Python SDK is not yet published. The examples below show the planned API surface.</div>
      </div>

      <h3>Installation (coming soon)</h3>
      <div class="code-wrapper">
        <div class="code-label">
          <span>Shell</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-bash">pip install agentpay</code></pre>
      </div>

      <h3>Initialize the client</h3>
      <div class="code-wrapper">
        <div class="code-label">
          <span>Python</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-python">import agentpay

client = agentpay.Client(api_key="ak_live_your_api_key")</code></pre>
      </div>

      <h3>Make a payment</h3>
      <div class="code-wrapper">
        <div class="code-label">
          <span>Python</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-python">txn = client.spend(
    amount=5.00,
    description="OpenAI GPT-4 API call",
    idempotency_key="req_abc123"
)

print(f"Transaction: {txn.id}")
print(f"Status: {txn.status}")
print(f"Remaining: ${txn.balance_remaining}")</code></pre>
      </div>

      <h3>Check balance</h3>
      <div class="code-wrapper">
        <div class="code-label">
          <span>Python</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-python">balance = client.balance()
print(f"Available: ${balance.available}")
print(f"Pending: ${balance.pending}")</code></pre>
      </div>

      <h3>List transactions</h3>
      <div class="code-wrapper">
        <div class="code-label">
          <span>Python</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-python">transactions = client.transactions(limit=10, status="completed")
for t in transactions:
    print(f"{t.created_at}: ${t.amount} ‚Äî {t.description}")</code></pre>
      </div>

      <h3>Send USDC</h3>
      <div class="code-wrapper">
        <div class="code-label">
          <span>Python</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-python">send = client.send_usdc(
    to_address="0x5678...efgh",
    amount=50.00,
    chain="base"
)
print(f"TX Hash: {send.tx_hash}")</code></pre>
      </div>

      <h3>Set up webhooks</h3>
      <div class="code-wrapper">
        <div class="code-label">
          <span>Python</span>
          <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
        </div>
        <pre><code class="language-python">webhook = client.create_webhook(
    url="https://your-server.com/webhooks/agentpay",
    events=["transaction.completed", "approval.required"]
)
print(f"Webhook secret: {webhook.secret}")

# Verify incoming webhook
from agentpay.webhooks import verify_signature

is_valid = verify_signature(
    payload=request.body,
    signature=request.headers["X-AgentPay-Signature"],
    secret=webhook.secret
)</code></pre>
      </div>

    </main>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    // Syntax highlighting
    hljs.highlightAll();

    // Copy to clipboard
    function copyCode(btn) {
      const wrapper = btn.closest('.code-wrapper');
      const code = wrapper.querySelector('pre code');
      if (!code) return;
      navigator.clipboard.writeText(code.textContent).then(() => {
        btn.classList.add('copied');
        const prev = btn.textContent;
        btn.textContent = '‚úÖ Copied!';
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.textContent = prev;
        }, 2000);
      });
    }

    // Active sidebar link on scroll
    const sections = document.querySelectorAll('h2[id], h3[id]');
    const sidebarLinks = document.querySelectorAll('.sidebar a');

    function updateActive() {
      let current = '';
      sections.forEach(section => {
        const top = section.getBoundingClientRect().top;
        if (top < 120) current = section.id;
      });
      sidebarLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + current) {
          link.classList.add('active');
        }
      });
    }

    window.addEventListener('scroll', updateActive, { passive: true });
    updateActive();

    // Close mobile sidebar on link click
    document.querySelectorAll('.sidebar a').forEach(a => {
      a.addEventListener('click', () => {
        document.querySelector('.sidebar').classList.remove('open');
      });
    });
  </script>
</body>
</html>
